import NodeCache from "node-cache";
import getCacheSettings from "./cacheSettings.js";
const h2 = 2 * 60 * 60 * 1000;
export const cache = new NodeCache(getCacheSettings("UserStatus"));
export function setCache(userId, state) {
    let endTime = state.endTime;
    if (state.endTime) {
        if (state.endTime < Date.now())
            return 1;
        if (state.endTime < state.startTime)
            return 2;
        endTime = state.endTime;
    }
    if (state.startTime > Date.now())
        state.startTime = Date.now();
    let ttl = endTime - Date.now();
    if (ttl > h2) {
        endTime = Date.now() + h2;
        state.endTime = endTime;
    }
    if (endTime) {
        cache.set(userId, state, ttl);
    }
    else {
        cache.set(userId, state);
    }
    return 0;
}
export function getCache(userId) {
    return cache.get(userId);
}
export function rmCache(userId) {
    cache.del(userId);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RhdHVzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vYmFjay9sb2dpYy9zdGF0dXMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxTQUFTLE1BQU0sWUFBWSxDQUFDO0FBR25DLE9BQU8sZ0JBQWdCLE1BQU0saUJBQWlCLENBQUM7QUFFL0MsTUFBTSxFQUFFLEdBQUcsQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsSUFBSSxDQUFDO0FBRTlCLE1BQU0sQ0FBQyxNQUFNLEtBQUssR0FBRyxJQUFJLFNBQVMsQ0FBQyxnQkFBZ0IsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDO0FBRW5FLE1BQU0sVUFBVSxRQUFRLENBQUMsTUFBVSxFQUFFLEtBQWE7SUFDOUMsSUFBSSxPQUFPLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQztJQUM1QixJQUFHLEtBQUssQ0FBQyxPQUFPLEVBQUMsQ0FBQztRQUNkLElBQUcsS0FBSyxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUMsR0FBRyxFQUFFO1lBQUUsT0FBTyxDQUFDLENBQUM7UUFDeEMsSUFBRyxLQUFLLENBQUMsT0FBTyxHQUFHLEtBQUssQ0FBQyxTQUFTO1lBQUUsT0FBTyxDQUFDLENBQUM7UUFDN0MsT0FBTyxHQUFHLEtBQUssQ0FBQyxPQUFPLENBQUM7SUFDNUIsQ0FBQztJQUNELElBQUcsS0FBSyxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsR0FBRyxFQUFFO1FBQUUsS0FBSyxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUM7SUFDOUQsSUFBSSxHQUFHLEdBQUcsT0FBTyxHQUFHLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQztJQUMvQixJQUFHLEdBQUcsR0FBRyxFQUFFLEVBQUMsQ0FBQztRQUNULE9BQU8sR0FBRyxJQUFJLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxDQUFDO1FBQzFCLEtBQUssQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDO0lBQzVCLENBQUM7SUFFRCxJQUFHLE9BQU8sRUFBQyxDQUFDO1FBQ1IsS0FBSyxDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsS0FBSyxFQUFFLEdBQUcsQ0FBQyxDQUFDO0lBQ2xDLENBQUM7U0FBSSxDQUFDO1FBQ0YsS0FBSyxDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDN0IsQ0FBQztJQUNELE9BQU8sQ0FBQyxDQUFDO0FBQ2IsQ0FBQztBQUVELE1BQU0sVUFBVSxRQUFRLENBQUMsTUFBVTtJQUMvQixPQUFPLEtBQUssQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUM7QUFDN0IsQ0FBQztBQUVELE1BQU0sVUFBVSxPQUFPLENBQUMsTUFBVTtJQUM5QixLQUFLLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0FBQ3RCLENBQUMifQ==