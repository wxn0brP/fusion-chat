import db from "../dataBase.js";
import { create, decode, KeyIndex } from "./token/index.js";
export async function authUser(token, tokenDecoded = { data: null }) {
    try {
        const data = await decode(token, KeyIndex.USER_TOKEN);
        if (!data)
            return false;
        tokenDecoded.data = data;
        const { id } = data;
        if (!id)
            return false;
        const tokenD = await db.data.findOne("token", { token });
        if (!tokenD)
            return false;
        const user = await db.data.findOne("user", { _id: id }, {}, { select: ["_id", "name", "email"] });
        if (!user)
            return false;
        return user;
    }
    catch {
        return false;
    }
}
export async function createUser(user) {
    const pay = {
        id: user._id,
    };
    return await create(pay, "30d", KeyIndex.USER_TOKEN);
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXV0aC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL2JhY2svbG9naWMvYXV0aC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsTUFBTSxLQUFLLENBQUM7QUFHckIsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLEVBQUUsUUFBUSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBUXpELE1BQU0sQ0FBQyxLQUFLLFVBQVUsUUFBUSxDQUFDLEtBQWEsRUFBRSxZQUFZLEdBQUMsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFO0lBQ3JFLElBQUcsQ0FBQztRQUNBLE1BQU0sSUFBSSxHQUFHLE1BQU0sTUFBTSxDQUFDLEtBQUssRUFBRSxRQUFRLENBQUMsVUFBVSxDQUFlLENBQUM7UUFDcEUsSUFBRyxDQUFDLElBQUk7WUFBRSxPQUFPLEtBQUssQ0FBQztRQUN2QixZQUFZLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztRQUV6QixNQUFNLEVBQUUsRUFBRSxFQUFFLEdBQUcsSUFBSSxDQUFDO1FBQ3BCLElBQUcsQ0FBQyxFQUFFO1lBQUUsT0FBTyxLQUFLLENBQUM7UUFFckIsTUFBTSxNQUFNLEdBQUcsTUFBTSxFQUFFLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLEVBQUUsRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDO1FBQ3pELElBQUcsQ0FBQyxNQUFNO1lBQUUsT0FBTyxLQUFLLENBQUM7UUFFekIsTUFBTSxJQUFJLEdBQUcsTUFBTSxFQUFFLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLEVBQUUsRUFBRSxHQUFHLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsTUFBTSxFQUFFLENBQUMsS0FBSyxFQUFFLE1BQU0sRUFBRSxPQUFPLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDbEcsSUFBRyxDQUFDLElBQUk7WUFBRSxPQUFPLEtBQUssQ0FBQztRQUV2QixPQUFPLElBQW1CLENBQUM7SUFDL0IsQ0FBQztJQUFBLE1BQUssQ0FBQztRQUNILE9BQU8sS0FBSyxDQUFDO0lBQ2pCLENBQUM7QUFDTCxDQUFDO0FBUUQsTUFBTSxDQUFDLEtBQUssVUFBVSxVQUFVLENBQUMsSUFBaUI7SUFDOUMsTUFBTSxHQUFHLEdBQUc7UUFDUixFQUFFLEVBQUUsSUFBSSxDQUFDLEdBQUc7S0FDZixDQUFBO0lBQ0QsT0FBTyxNQUFNLE1BQU0sQ0FBQyxHQUFHLEVBQUUsS0FBSyxFQUFFLFFBQVEsQ0FBQyxVQUFVLENBQUMsQ0FBQztBQUN6RCxDQUFDIn0=