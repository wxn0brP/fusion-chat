import { readFileSync, watchFile } from "fs";
import InternalCode from "./codes/index.js";
let config = [];
export function expressMiddleware(req, res, next) {
    const ip = req.headers['x-forwarded-for'] || req.socket.remoteAddress;
    if (ip == "::1")
        return next();
    if (config.includes(ip)) {
        return res.status(403).json({ err: true, c: InternalCode.UserError.Express.IpBanned, msg: "Access denied. IP address is banned." });
    }
    next();
}
export function socketIoMiddleware(socket, next) {
    const ip = socket.request.headers['x-forwarded-for'] || socket.request.socket.remoteAddress;
    if (ip == "::1")
        return next();
    if (config.includes(ip)) {
        return next(new Error("Access denied. IP address is banned."));
    }
    next();
}
function loadConfig() {
    config = JSON.parse(readFileSync("config/bannedIP.json", "utf8"));
    if (!Array.isArray(config)) {
        config = [];
        console.error("config/bannedIP.json must be an string array.");
    }
}
loadConfig();
watchFile("config/bannedIP.json", () => {
    loadConfig();
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFubmVkSXAuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9iYWNrL2Jhbm5lZElwLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxZQUFZLEVBQUUsU0FBUyxFQUFFLE1BQU0sSUFBSSxDQUFDO0FBQzdDLE9BQU8sWUFBWSxNQUFNLFNBQVMsQ0FBQztBQUVuQyxJQUFJLE1BQU0sR0FBRyxFQUFFLENBQUM7QUFFaEIsTUFBTSxVQUFVLGlCQUFpQixDQUFDLEdBQUcsRUFBRSxHQUFHLEVBQUUsSUFBSTtJQUM1QyxNQUFNLEVBQUUsR0FBRyxHQUFHLENBQUMsT0FBTyxDQUFDLGlCQUFpQixDQUFDLElBQUksR0FBRyxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUM7SUFDdEUsSUFBSSxFQUFFLElBQUksS0FBSztRQUFFLE9BQU8sSUFBSSxFQUFFLENBQUM7SUFFL0IsSUFBSSxNQUFNLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUM7UUFDdEIsT0FBTyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLEdBQUcsRUFBRSxJQUFJLEVBQUUsQ0FBQyxFQUFFLFlBQVksQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLFFBQVEsRUFBRSxHQUFHLEVBQUUsc0NBQXNDLEVBQUUsQ0FBQyxDQUFDO0lBQ3hJLENBQUM7SUFDRCxJQUFJLEVBQUUsQ0FBQztBQUNYLENBQUM7QUFFRCxNQUFNLFVBQVUsa0JBQWtCLENBQUMsTUFBTSxFQUFFLElBQUk7SUFDM0MsTUFBTSxFQUFFLEdBQUcsTUFBTSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsaUJBQWlCLENBQUMsSUFBSSxNQUFNLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUM7SUFDNUYsSUFBSSxFQUFFLElBQUksS0FBSztRQUFFLE9BQU8sSUFBSSxFQUFFLENBQUM7SUFFL0IsSUFBSSxNQUFNLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUM7UUFDdEIsT0FBTyxJQUFJLENBQUMsSUFBSSxLQUFLLENBQUMsc0NBQXNDLENBQUMsQ0FBQyxDQUFDO0lBQ25FLENBQUM7SUFDRCxJQUFJLEVBQUUsQ0FBQztBQUNYLENBQUM7QUFFRCxTQUFTLFVBQVU7SUFDZixNQUFNLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsc0JBQXNCLEVBQUUsTUFBTSxDQUFDLENBQUMsQ0FBQztJQUNsRSxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDO1FBQ3pCLE1BQU0sR0FBRyxFQUFFLENBQUM7UUFDWixPQUFPLENBQUMsS0FBSyxDQUFDLCtDQUErQyxDQUFDLENBQUM7SUFDbkUsQ0FBQztBQUNMLENBQUM7QUFFRCxVQUFVLEVBQUUsQ0FBQztBQUNiLFNBQVMsQ0FBQyxzQkFBc0IsRUFBRSxHQUFHLEVBQUU7SUFDbkMsVUFBVSxFQUFFLENBQUM7QUFDakIsQ0FBQyxDQUFDLENBQUMifQ==