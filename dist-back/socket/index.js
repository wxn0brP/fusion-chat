import { Server } from "socket.io";
import db from "../dataBase.js";
import { socketIoMiddleware } from "../bannedIp.js";
global.io = new Server(global.server);
global.getSocket = (to, room = "") => {
    const namespace = global.io.of("/" + room);
    const sockets = Array.from(namespace.sockets.values());
    return sockets.filter(socket => socket.user._id === to);
};
global.sendToSocket = (id, channel, ...args) => {
    let sockets = global.getSocket(id);
    sockets.forEach(socket => {
        socket.emit(channel, ...args);
    });
};
global.sendToChatUsers = async (to, channel, ...args) => {
    const users = await db.realmUser.find(to, {});
    for (const user of users) {
        if ('bot' in user) {
            global.getSocket(user.bot, "bot").forEach(conn => {
                conn.emit(channel, ...args);
            });
        }
        else {
            global.sendToSocket(user.u, channel, ...args);
        }
    }
};
global.io.use(socketIoMiddleware);
await import("./chat/index.js");
await import("./bot/index.js");
await import("./dev-panel/index.js");
await import("./qrCodeLogin.js");
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9iYWNrL3NvY2tldC9pbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsTUFBTSxFQUFVLE1BQU0sV0FBVyxDQUFDO0FBQzNDLE9BQU8sRUFBRSxNQUFNLEtBQUssQ0FBQztBQUNyQixPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFFakQsTUFBTSxDQUFDLEVBQUUsR0FBRyxJQUFJLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUM7QUFFdEMsTUFBTSxDQUFDLFNBQVMsR0FBRyxDQUFDLEVBQUUsRUFBRSxJQUFJLEdBQUcsRUFBRSxFQUFFLEVBQUU7SUFDakMsTUFBTSxTQUFTLEdBQUcsTUFBTSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsR0FBRyxHQUFHLElBQUksQ0FBQyxDQUFDO0lBQzNDLE1BQU0sT0FBTyxHQUFhLEtBQUssQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDO0lBRWpFLE9BQU8sT0FBTyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxLQUFLLEVBQUUsQ0FBQyxDQUFDO0FBQzVELENBQUMsQ0FBQTtBQUVELE1BQU0sQ0FBQyxZQUFZLEdBQUcsQ0FBQyxFQUFFLEVBQUUsT0FBTyxFQUFFLEdBQUcsSUFBSSxFQUFFLEVBQUU7SUFDM0MsSUFBSSxPQUFPLEdBQUcsTUFBTSxDQUFDLFNBQVMsQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUNuQyxPQUFPLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxFQUFFO1FBQ3JCLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLEdBQUcsSUFBSSxDQUFDLENBQUM7SUFDbEMsQ0FBQyxDQUFDLENBQUM7QUFDUCxDQUFDLENBQUE7QUFFRCxNQUFNLENBQUMsZUFBZSxHQUFHLEtBQUssRUFBRSxFQUFFLEVBQUUsT0FBTyxFQUFFLEdBQUcsSUFBSSxFQUFFLEVBQUU7SUFDcEQsTUFBTSxLQUFLLEdBQUcsTUFBTSxFQUFFLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBb0IsRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBQ2pFLEtBQUksTUFBTSxJQUFJLElBQUksS0FBSyxFQUFDLENBQUM7UUFDckIsSUFBRyxLQUFLLElBQUksSUFBSSxFQUFDLENBQUM7WUFDZCxNQUFNLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsS0FBSyxDQUFDLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFO2dCQUM3QyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxHQUFHLElBQUksQ0FBQyxDQUFDO1lBQ2hDLENBQUMsQ0FBQyxDQUFDO1FBQ1AsQ0FBQzthQUFJLENBQUM7WUFDRixNQUFNLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsT0FBTyxFQUFFLEdBQUcsSUFBSSxDQUFDLENBQUM7UUFDbEQsQ0FBQztJQUNMLENBQUM7QUFDTCxDQUFDLENBQUE7QUFFRCxNQUFNLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO0FBRWxDLE1BQU0sTUFBTSxDQUFDLGlCQUFpQixDQUFDLENBQUM7QUFDaEMsTUFBTSxNQUFNLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztBQUMvQixNQUFNLE1BQU0sQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO0FBQ3JDLE1BQU0sTUFBTSxDQUFDLGtCQUFrQixDQUFDLENBQUMifQ==