import db from "../../../../../dataBase.js";
export async function saveDbChanges(doc, changes, idName = "_id") {
    const { itemsToAdd, itemsToRemove, itemsToUpdate, itemsWithRemovedFields } = changes;
    const dbc = db.realmConf.c(doc);
    for (const item of itemsToAdd) {
        await dbc.add(item, false);
    }
    for (const item of itemsToRemove) {
        await dbc.remove({ [idName]: item[idName] }, { item, idName });
    }
    for (const item of itemsToUpdate) {
        await dbc.update({ [idName]: item[idName] }, item);
    }
    for (const item of itemsWithRemovedFields) {
        const unset = Object.fromEntries(item.deletedParams.map((p) => [p, true]));
        await dbc.update({ [idName]: item[idName] }, { $unset: unset });
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidXRpbHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9iYWNrL3NvY2tldC9jaGF0L2xvZ2ljL3JlYWxtU2V0dGluZ3Mvc2V0L3V0aWxzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxNQUFNLEtBQUssQ0FBQztBQU1yQixNQUFNLENBQUMsS0FBSyxVQUFVLGFBQWEsQ0FBQyxHQUFXLEVBQUUsT0FBK0IsRUFBRSxTQUFpQixLQUFLO0lBQ3BHLE1BQU0sRUFBRSxVQUFVLEVBQUUsYUFBYSxFQUFFLGFBQWEsRUFBRSxzQkFBc0IsRUFBRSxHQUFHLE9BQU8sQ0FBQztJQUNyRixNQUFNLEdBQUcsR0FBRyxFQUFFLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUVoQyxLQUFLLE1BQU0sSUFBSSxJQUFJLFVBQVUsRUFBRSxDQUFDO1FBQzVCLE1BQU0sR0FBRyxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFDL0IsQ0FBQztJQUVELEtBQUssTUFBTSxJQUFJLElBQUksYUFBYSxFQUFFLENBQUM7UUFDL0IsTUFBTSxHQUFHLENBQUMsTUFBTSxDQUNaLEVBQUUsQ0FBQyxNQUFNLENBQUMsRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLEVBQUUsRUFDMUIsRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLENBQ25CLENBQUM7SUFDTixDQUFDO0lBRUQsS0FBSyxNQUFNLElBQUksSUFBSSxhQUFhLEVBQUUsQ0FBQztRQUMvQixNQUFNLEdBQUcsQ0FBQyxNQUFNLENBQ1osRUFBRSxDQUFDLE1BQU0sQ0FBQyxFQUFFLElBQUksQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUMxQixJQUFJLENBQ1AsQ0FBQztJQUNOLENBQUM7SUFFRCxLQUFLLE1BQU0sSUFBSSxJQUFJLHNCQUFzQixFQUFFLENBQUM7UUFDeEMsTUFBTSxLQUFLLEdBQUcsTUFBTSxDQUFDLFdBQVcsQ0FDNUIsSUFBSSxDQUFDLGFBQWEsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDLENBQzNDLENBQUM7UUFFRixNQUFNLEdBQUcsQ0FBQyxNQUFNLENBQ1osRUFBRSxDQUFDLE1BQU0sQ0FBQyxFQUFFLElBQUksQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUMxQixFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsQ0FDcEIsQ0FBQztJQUNOLENBQUM7QUFDTCxDQUFDIn0=