import { saveDbChanges } from "./utils.js";
import { addCustom } from "../../../../../logic/webhooks/index.js";
import { db, processDbChanges } from "./imports.js";
export default async (id, data, suser, dbData) => {
    const oldWebhooks = dbData.filter(d => "whid" in d);
    const changes = processDbChanges(oldWebhooks, data.webhooks, ["name", "template", "chnl", "require", "ajv", "embed"], "whid");
    const itemsToAdd = [...changes.itemsToAdd];
    changes.itemsToAdd = [];
    await saveDbChanges(id, changes, "whid");
    for (const item of itemsToAdd) {
        const webhookInfo = {
            name: item.name,
            chat: id,
            chnl: item.chnl,
            template: item.template,
            required: item.require || [],
            ajv: item.ajv || {}
        };
        await addCustom(webhookInfo);
    }
    for (const item of changes.itemsToRemove) {
        await db.data.add("rm", { _id: item.whid });
    }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2ViaG9va3MuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9iYWNrL3NvY2tldC9jaGF0L2xvZ2ljL3JlYWxtU2V0dGluZ3Mvc2V0L3dlYmhvb2tzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxTQUFTLENBQUM7QUFHeEMsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBQ2xELE9BQU8sRUFBRSxFQUFFLEVBQU0sZ0JBQWdCLEVBQXFDLE1BQU0sV0FBVyxDQUFDO0FBRXhGLGVBQWUsS0FBSyxFQUFFLEVBQU0sRUFBRSxJQUEwQixFQUFFLEtBQWtCLEVBQUUsTUFBd0IsRUFBRSxFQUFFO0lBQ3RHLE1BQU0sV0FBVyxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxNQUFNLElBQUksQ0FBQyxDQUFDLENBQUM7SUFDcEQsTUFBTSxPQUFPLEdBQUcsZ0JBQWdCLENBQzVCLFdBQVcsRUFDWCxJQUFJLENBQUMsUUFBUSxFQUNiLENBQUMsTUFBTSxFQUFFLFVBQVUsRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxPQUFPLENBQUMsRUFDdkQsTUFBTSxDQUNULENBQUM7SUFFRixNQUFNLFVBQVUsR0FBRyxDQUFDLEdBQUcsT0FBTyxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBQzNDLE9BQU8sQ0FBQyxVQUFVLEdBQUcsRUFBRSxDQUFDO0lBQ3hCLE1BQU0sYUFBYSxDQUFDLEVBQUUsRUFBRSxPQUFPLEVBQUUsTUFBTSxDQUFDLENBQUM7SUFFekMsS0FBSSxNQUFNLElBQUksSUFBSSxVQUFVLEVBQUMsQ0FBQztRQUMxQixNQUFNLFdBQVcsR0FBa0M7WUFDL0MsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJO1lBQ2YsSUFBSSxFQUFFLEVBQUU7WUFDUixJQUFJLEVBQUUsSUFBSSxDQUFDLElBQUk7WUFDZixRQUFRLEVBQUUsSUFBSSxDQUFDLFFBQVE7WUFDdkIsUUFBUSxFQUFFLElBQUksQ0FBQyxPQUFPLElBQUksRUFBRTtZQUM1QixHQUFHLEVBQUUsSUFBSSxDQUFDLEdBQUcsSUFBSSxFQUFFO1NBQ3RCLENBQUM7UUFDRixNQUFNLFNBQVMsQ0FBQyxXQUFXLENBQUMsQ0FBQztJQUNqQyxDQUFDO0lBRUQsS0FBSSxNQUFNLElBQUksSUFBSSxPQUFPLENBQUMsYUFBYSxFQUFDLENBQUM7UUFDckMsTUFBTSxFQUFFLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsRUFBRSxHQUFHLEVBQUUsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDLENBQUM7SUFDaEQsQ0FBQztBQUNMLENBQUMsQ0FBQSJ9